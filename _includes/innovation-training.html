<script type="text/javascript" src="./js/underscore-min.js"></script>
<script id="training-list-item" type="text/x-underscore-template">
  <div class="innovation-report">
    <img class="pull-left" src="http://img.static.reliefweb.int/sites/reliefweb.int/files/styles/s/public/country-icons/<%= fields.country[0].iso3 %>.png"/>
    <div class="text">
      <div class="date"><%= formatted_date %></div>
      <div class="country"><%= fields.country[0].name %></div>
      <a href="<%= fields.url %>"><%= fields.title %></a>
      <div class="source">Training -- <%= fields.source[0].shortname %></div>
    </div>
  </div>
</script>
<script type="text/javascript">
var INNOVATION_TRAINING = {
  handlerData : function(results) {
    var html = '<div class="innovation-training-list thumbnail">';
    if (results.data.length > 0) {
      var source = $("#training-list-item").html();
      var compiled = _.template(source);
      _.each(results.data, function(item) {
        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"];
        var timestamp = new Date(item.fields.date.created);
        item.formatted_date = timestamp.getDate() + ' ' + monthNames[timestamp.getMonth()] + ' ' + timestamp.getFullYear();
        html += compiled(item);
      });
    }
    else {
      html += '<div class="innovation-report">There are no current training opportunities referencing "innovation", "technology" and "information"</div>';
    }
    html += '<a class="more-link" href="http://reliefweb.int/training?search=innovation+AND+technology+AND+information">More on ReliefWeb &raquo;</a>';
    html += '</div>';
    $("#innovation-training").html(html);
  },
  loadReports : function() {
    $.ajax({
      url:'http://api.rwlabs.org/v1/training?query[value]=innovation%20AND%20technology%20AND%20information&query[fields][]=title&query[fields][]=body&fields[include][]=title&fields[include][]=date.created&fields[include][]=url&fields[include][]=country.name&fields[include][]=source.shortname&fields[include][]=country.iso3&sort[]=date:desc&limit=5',
      method:'get',
    }).done(this.handlerData);
  }
}
$( document ).ready(function() {
  INNOVATION_TRAINING.loadReports();
});
</script>
<div id="innovation-training"></div>
