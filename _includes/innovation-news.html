<script type="text/javascript" src="./js/underscore-min.js"></script>
<script id="list-item" type="text/x-underscore-template">
  <div class="innovation-report">
    <img class="pull-left" src="http://img.static.reliefweb.int/sites/reliefweb.int/files/styles/s/public/country-icons/<%= fields.primary_country.iso3 %>.png"/>
    <div class="text">
      <div class="date"><%= formatted_date %></div>
      <div class="country"><%= fields.primary_country.name %></div>
      <a href="<%= fields.url %>"><%= fields.title %></a>
      <div class="source">Report -- <%= fields.source[0].shortname %></div>
    </div>
  </div>
</script>
<script type="text/javascript">
var INNOVATION_NEWS = {
  handlerData : function(results) {
    var html = '<div class="innovation-report-list thumbnail">';
    var source = $("#list-item").html();
    var compiled = _.template(source);
    _.each(results.data, function(item) {
      var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"];
      var timestamp = new Date(item.fields.date.original);
      item.formatted_date = timestamp.getDate() + ' ' + monthNames[timestamp.getMonth()] + ' ' + timestamp.getFullYear();
      html += compiled(item);
    });
    html += '<a class="more-link" href="http://reliefweb.int/updates?search=innovation+AND+technology+AND+information">More on ReliefWeb &raquo;</a>';
    html += '</div>';
    $("#innovation-news").html(html);
  },
  loadReports : function() {
    $.ajax({
      url:'http://api.rwlabs.org/v1/reports?query[value]=innovation%20AND%20technology%20AND%20information&query[fields][]=title&query[fields][]=body&fields[include][]=title&fields[include][]=date.original&fields[include][]=url&fields[include][]=primary_country.name&fields[include][]=source.shortname&fields[include][]=primary_country.iso3&sort[]=date:desc&limit=5',
      method:'get',
    }).done(this.handlerData);
  }
}
$( document ).ready(function() {
  INNOVATION_NEWS.loadReports();
});
</script>
<div id="innovation-news"></div>
